function SfxrParams(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,l,f,C,K,D,p,L;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001);e=100/(a.g*a.g+.001);l=1-a.h*a.h*a.h*.01;f=-a.i*a.i*a.i*1E-6;a.a||(p=.5-a.n/2,L=5E-5*-a.o);C=1+a.l*a.l*(0<a.l?-.9:10);K=0;D=1==a.m?0:(1-a.m)*(1-a.m)*2E4+32};this.totalReset=function(){this.reset();var d=this._params;a=d.b*d.b*1E5;b=d.c*d.c*1E5;c=d.e*d.e*1E5+12;return 3*((a+b+c)/3|0)};this.synthWave=function(X,M){var h=this._params,N=1!=h.s||h.v,u=h.v*h.v*.1,O=
1+3E-4*h.w,q=h.s*h.s*h.s*.1,Y=1+1E-4*h.t,Z=1!=h.s,aa=h.x*h.x,ba=h.g,P=h.q||h.r,ca=h.r*h.r*h.r*.2,Q=h.q*h.q*(0>h.q?-1020:1020),R=h.p?((1-h.p)*(1-h.p)*2E4|0)+32:0,da=h.d,S=h.j/2,ea=h.k*h.k*.01,G=h.a,H=a,fa=1/a,ga=1/b,ha=1/c,h=5/(1+h.u*h.u*20)*(.01+q);.8<h&&(h=.8);for(var h=1-h,I=!1,T=0,w=0,x=0,U=0,E=0,z,A=0,m,r=0,t,J=0,k,V=0,v,W=0,F=Array(1024),B=Array(32),n=F.length;n--;)F[n]=0;for(n=B.length;n--;)B[n]=2*Math.random()-1;for(n=0;n<M;n++){if(I)return n;R&&++V>=R&&(V=0,this.reset());D&&++K>=D&&(D=0,d*=
C);l+=f;d*=l;d>e&&(d=e,0<ba&&(I=!0));m=d;0<S&&(W+=ea,m*=1+Math.sin(W)*S);m|=0;8>m&&(m=8);G||(p+=L,0>p?p=0:.5<p&&(p=.5));if(++w>H)switch(w=0,++T){case 1:H=b;break;case 2:H=c}switch(T){case 0:x=w*fa;break;case 1:x=1+2*(1-w*ga)*da;break;case 2:x=1-w*ha;break;case 3:x=0,I=!0}P&&(Q+=ca,t=Q|0,0>t?t=-t:1023<t&&(t=1023));N&&O&&(u*=O,1E-5>u?u=1E-5:.1<u&&(u=.1));v=0;for(var ia=8;ia--;){r++;if(r>=m&&(r%=m,3==G))for(z=B.length;z--;)B[z]=2*Math.random()-1;switch(G){case 0:k=r/m<p?.5:-.5;break;case 1:k=1-r/m*2;
break;case 2:k=r/m;k=6.28318531*(.5<k?k-1:k);k=1.27323954*k+.405284735*k*k*(0>k?1:-1);k=.225*((0>k?-1:1)*k*k-k)+k;break;case 3:k=B[Math.abs(32*r/m|0)]}N&&(z=A,q*=Y,0>q?q=0:.1<q&&(q=.1),Z?(E+=(k-A)*q,E*=h):(A=k,E=0),A+=E,U+=A-z,k=U*=1-u);P&&(F[J%1024]=k,k+=F[(J-t+1024)%1024],J++);v+=k}v*=.125*x*aa;X[n]=1<=v?32767:-1>=v?-32768:32767*v|0}return M}}var synth=new SfxrSynth;
window.jsfxr=function(a){synth._params.setSettings(a);var b=synth.totalReset();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*synth.synthWave(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410;c[1]=b+36;c[2]=1163280727;c[3]=544501094;c[4]=16;c[5]=65537;c[6]=44100;c[7]=88200;c[8]=1048578;c[9]=1635017060;c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";c<b;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e&63]);return d};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();
var Renderer=function(a){this.game=a;this.canvas=document.getElementById("g");this.ctx=this.canvas.getContext("2d",{alpha:!0});this.ctx.mozImageSmoothingEnabled=!1;this.ctx.webkitImageSmoothingEnabled=!1;this.ctx.msImageSmoothingEnabled=!1;this.ctx.imageSmoothingEnabled=!1};Renderer.prototype.draw=function(a){};Renderer.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};
Renderer.prototype.drawText=function(a,b,c,d){var e=this.ctx;d=d?d:{};var l=d.fontSize?d.fontSize:"12px",f=d.fontType?d.fontType:"normal",C=d.fontFamily?d.fontFamily:"arial";e.save();e.font=f+" "+l+" "+C;e.textAlign=d.textAlign||"left";e.textBaseline=d.textBaseline||"alphabetic";d.stroke?(e.strokeStyle=d.color||"black",e.lineWidth=d.lineWidth||1,e.strokeText(a,b,c)):(e.fillStyle=d.color||"black",e.fillText(a,b,c));e.restore()};
Renderer.prototype.drawButton=function(a,b,c,d,e,l){var f=this.ctx;f.save();f.fillStyle="white";f.fillRect(c,d,e,l);f.strokeStyle="black";f.lineWidth=2;f.strokeRect(c,d,e,l);this.drawText(a,c+e/2,d+l/2,{fontSize:b,textAlign:"center",textBaseline:"middle"});f.restore()};
var Mouse=function(a){this.game=a;this.y=this.x=0;var b=this;a.renderer.canvas.addEventListener("mousemove",function(a){a=b.getCursorPosition(a);var d=b.game.screen.scale;b.x=a.x/d;b.y=a.y/d});this.clickCallbacks=[];this.game.renderer.canvas.addEventListener("click",function(a){a=b.getCursorPosition(a);var d=b.game.screen.scale,e;for(e in b.clickCallbacks)b.clickCallbacks[e](a.x/d,a.y/d)})};Mouse.prototype.onClick=function(a){this.clickCallbacks.push(a)};
Mouse.prototype.getCursorPosition=function(a){var b=this.game.renderer.canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};var Entity=function(a,b,c,d,e,l,f){this.game=a;this.x=b;this.y=c;this.w=d;this.h=e;this.vx=l||0;this.vy=f||0;this.dy=this.dx=-1;this.angle=0;this.speed=100;this.py=this.px=.5;this.color="black";this.group=null;this.isAlive=!0;this.sprite=null;this.mirror=!1;this.scale=1;this.hitbox=null;this.rx=b;this.ty=c;this.gravity=0;this.lifeTime=null};
Entity.prototype.update=function(a){if(null!=this.lifeTime&&(this.lifeTime-=1E3*a,0>=this.lifeTime)){this.kill();return}this.moveToDestiny(a);this.sprite?(this.sprite.animation.update(a),this.rx=this.x-this.sprite.w*this.px*this.scale,this.ry=this.y-this.sprite.h*this.py*this.scale):(this.rx=this.x-this.w*this.px*this.scale,this.ry=this.y-this.h*this.py*this.scale)};
Entity.prototype.draw=function(a){a.fillStyle=this.color;if(this.sprite){var b=this.sprite.animation.getCurrentFrame()[1]*this.sprite.w,c=this.sprite.animation.getCurrentFrame()[0]*this.sprite.h;a.save();a.translate(this.x,this.y);a.rotate(this.angle);this.mirror&&a.scale(-1,1);a.drawImage(this.sprite.image,b,c,this.sprite.w,this.sprite.h,-this.sprite.w*this.px*this.scale,-this.sprite.h*this.py*this.scale,this.sprite.w*this.scale,this.sprite.h*this.scale);a.restore()}else this.rx=this.x-this.w*this.px*
this.scale,this.ry=this.y-this.h*this.py*this.scale,a.fillRect(this.x-this.w*this.px,this.y-this.h*this.py,this.w,this.h)};Entity.prototype.moveToDestiny=function(a){if(-1!=this.dx||-1!=this.dy){var b=this.dx-this.x,c=this.dy-this.y,d=Math.atan2(c,b);if(2>Math.sqrt(b*b+c*c)){this.x=Math.floor(this.dx);this.y=Math.floor(this.dy);return}this.vx=Math.cos(d)*this.speed;this.vy=Math.sin(d)*this.speed}this.vy+=this.gravity*a;this.x+=this.vx*a;this.y+=this.vy*a};
Entity.prototype.kill=function(){this.isAlive=!1;null!=this.group?this.game.entities[this.group].splice(this.game.entities[this.group].indexOf(this),1):this.game.entities.splice(this.game.entities.indexOf(this),1)};Entity.prototype.destiny=function(a,b){this.dx=a;this.dy=b};Entity.prototype.position=function(a,b){this.x=a;this.y=b};Entity.prototype.velocity=function(a,b){this.vx=a;this.vy=b};Entity.prototype.setHitbox=function(a,b,c,d){this.hitbox={offsetX:a,offsetY:b,w:c,h:d}};
var Enemy=function(a,b,c,d,e){Entity.call(this,a,b,c,d,e);this.py=this.px=.5;this.sprite=new Sprite(a,a.assetManager.assets.robot,16,16);this.sprite.addAnimation(new Animation(a,"walking",[[0,0],[0,1]],100));this.sprite.setAnimation("walking");console.log(b,this.game.screen.w/2);this.x>=this.game.screen.w/2&&(this.mirror=!0);this.setHitbox(0,0,this.sprite.w,this.sprite.h);this.scale=3;this.visionHitbox={offsetX:0,offsetY:0,w:100,h:30};this.timeToOver=1E3};Enemy.prototype=Object.create(Entity.prototype);
Enemy.prototype.update=function(a){Entity.prototype.update.call(this,a);this.setHitbox(-60/this.scale,-60/this.scale,(120+this.sprite.w*this.scale)/this.scale,(120+this.sprite.h*this.scale)/this.scale);var b=this.game.currentState.hero;this.game.hasCollision(this,b)?this.destiny(b.x,b.y):this.destiny(this.game.screen.hw,this.game.screen.hh);this.setHitbox(0,0,this.sprite.w,this.sprite.h);var c=this.game.currentState.core;if(c.isAlive&&b.isAlive){if(this.game.hasCollision(this,c)){this.game.audioManager.play("explosion2");
c.kill();a=c.w/10;for(var d=0;30>d;d++){var e=new Entity(this.game,c.x,c.y,a,a);e.update=function(a){Entity.prototype.update.call(this,a);this.color=this.game.colors[Math.floor(6*Math.random())]};e.lifeTime=1E3;e.gravity=50;e.vx=200-400*Math.random();e.vy=200-400*Math.random();this.game.add(e,"particles")}}if(this.game.hasCollision(this,b))for(this.game.audioManager.play("hit"),b.kill(),b.gun.kill(),d=0;30>d;d++)e=new Entity(this.game,b.x,b.y,5,5),e.update=function(a){Entity.prototype.update.call(this,
a);this.color="red"},e.lifeTime=1E3,e.gravity=100,e.vx=50-100*Math.random(),e.vy=50-100*Math.random(),this.game.add(e,"particles")}else this.timeToOver-=1E3*a,0>=this.timeToOver&&this.game.startState("gameover",Math.floor(this.game.currentState.score))};
var Hero=function(a,b,c){Entity.call(this,a,b,c);this.isSelected=!1;this.cooldown=5E3;this.canShoot=!0;this.scale=2.5;this.sprite=new Sprite(a,a.assetManager.assets.hero1,7,14);this.sprite.addAnimation(new Animation(a,"idle",[[0,0]]));this.sprite.addAnimation(new Animation(a,"walking",[[0,0],[0,1],[0,2]],50));this.sprite.setAnimation("idle");this.setHitbox(0,0,this.sprite.w,this.sprite.h)};Hero.prototype=Object.create(Entity.prototype);
Hero.prototype.update=function(a){Entity.prototype.update.call(this,a);this.speed+=.5*a;var b=this.game.keyboard,c=Math.abs(this.vy)/2,d=Math.abs(this.vx)/2;b.isDown(b.keys.A)||b.isDown(b.keys.LEFT)?(this.sprite.setAnimation("walking"),this.vx=-this.speed+c):b.isDown(b.keys.D)||b.isDown(b.keys.RIGHT)?(this.sprite.setAnimation("walking"),this.vx=this.speed-c):this.vx=0;b.isDown(b.keys.W)||b.isDown(b.keys.UP)?(this.vy=-this.speed+d,this.sprite.setAnimation("walking")):b.isDown(b.keys.S)||b.isDown(b.keys.DOWN)?
(this.vy=this.speed-d,this.sprite.setAnimation("walking")):this.vy=0;0==this.vx&&0==this.vy&&this.sprite.setAnimation("idle");0>=this.cooldown&&!this.canShoot?this.canShoot=!0:this.cooldown-=1E3*a};Hero.prototype.shoot=function(a){this.canShoot&&(this.canShoot=!1,this.cooldown=1E3,a=new Bullet(this.game,this,a),this.game.add(a,"bullets"))};Hero.prototype.onCollide=function(a){console.log("colliding on",a)};
var Gun=function(a,b){Entity.call(this,a,b.x,b.y);this.game=a;this.owner=b;this.px=0;this.scale=2.5;this.sprite=new Sprite(a,a.assetManager.assets.gun,9,3);this.sprite.addAnimation(new Animation(a,"gunr",[[0,0],[0,1]],20));this.sprite.addAnimation(new Animation(a,"gunl",[[1,0],[1,1]],20));this.sprite.setAnimation("gunr")};Gun.prototype=Object.create(Entity.prototype);
Gun.prototype.update=function(a){Entity.prototype.update.call(this,a);this.x=this.owner.x;this.y=this.owner.y;a=this.game.mouse;this.angle=Math.atan2(a.y-this.y,a.x-this.x);a=180*this.angle/Math.PI;90<a||-90>a?(this.sprite.setAnimation("gunl"),this.owner.mirror=!0):(this.sprite.setAnimation("gunr"),this.owner.mirror=!1)};var Core=function(a){Entity.call(this,a);this.x=a.screen.hw;this.y=a.screen.hh;this.h=this.w=20;this.setHitbox(0,0,this.w,this.h)};Core.prototype=Object.create(Entity.prototype);
Core.prototype.update=function(a){Entity.prototype.update.call(this,a);this.w+=a;this.h+=a;this.setHitbox(0,0,this.w,this.h)};Core.prototype.draw=function(a){for(var b=0;b<this.w;b+=5)for(var c=0;c<this.w;c+=5)a.fillStyle=this.game.colors[Math.floor(6*Math.random())],a.fillRect(this.rx+b,this.ry+c,5,5)};
var Bullet=function(a,b,c){Entity.call(this,a,b.x,b.y,10,5);this.owner=b;this.angle=c;this.speed=500;this.scale=4;this.sprite=new Sprite(a,a.assetManager.assets.bullet,3,2);this.sprite.addAnimation(new Animation(a,"fire",[[0,0],[0,1],[0,2],[0,0],[0,2],[0,1]],20));this.sprite.setAnimation("fire");this.setHitbox(0,-0,this.sprite.w,this.sprite.h);this.lifeTime=2E3};Bullet.prototype=Object.create(Entity.prototype);
Bullet.prototype.update=function(a){Entity.prototype.update.call(this,a);var b=this.game.entities.enemies,c;for(c in b)if(a=b[c],this.game.hasCollision(this,a)){this.kill();a.kill();this.game.audioManager.play("explosion1");for(c=0;c<10*a.scale;c++)b=new Entity(this.game,this.x,this.y,5,5),b.update=function(a){Entity.prototype.update.call(this,a);this.color=this.game.colors[Math.floor(6*Math.random())]},b.lifeTime=500,b.gravity=100,b.vx=50-100*Math.random(),b.vy=50-100*Math.random(),this.game.add(b,
"particles");break}this.game.hasCollision(this,this.game.currentState.core)&&this.kill()};var Time=function(a){this.game=a;this.lastDate=null;this.deltaTime=0};Time.prototype.update=function(){var a=Date.now();this.deltaTime=(a-this.lastDate)/1E3;this.lastDate=a};var AssetManager=function(a){this.game=a;this.assets={};this.assetsFail={};this.assetsLoaded=this.assetsFailed=0;this.finishedLoad=!1;this.callbackOnLoad=null};
AssetManager.prototype.load=function(a){var b=this;this.totalAssets=a.length;for(var c in a)(function(){var d=a[c],e=new Image;e.addEventListener("load",function(){b.assets[d.name]=e;b.assetsLoaded++;b.finishLoad()});e.addEventListener("error",function(){b.assetsFail[d.name]=e;b.assetsFailed++;b.finishLoad()});e.src=d.path})()};AssetManager.prototype.finishLoad=function(){this.totalAssets==this.assetsLoaded+this.assetsFailed&&(this.finishedLoad=!0,this.callbackOnLoad(),console.log("callback"))};
AssetManager.prototype.onFinishLoad=function(a){this.callbackOnLoad=a};var AudioManager=function(a){this.game=a;this.sounds={}};AudioManager.prototype.load=function(a){for(var b in a)this.sounds[b]=jsfxr(a[b])};AudioManager.prototype.play=function(a){var b=new Audio;b.src=this.sounds[a];b.play()};
var Screen=function(a,b,c){this.game=a;this.w=b;this.h=c;this.hw=b/2;this.hh=c/2;this.scale=1;this.resize();var d=this;window.addEventListener("resize",this.resize.bind(this));window.addEventListener("focus",function(){d.game.pause=!1;d.game.time.lastDate=Date.now()});window.addEventListener("blur",function(){d.game.pause=!0})};
Screen.prototype.resize=function(){var a=window.innerWidth,b=window.innerHeight,a=a/b>this.w/this.h?b/this.h:a/this.w;this.game.renderer.canvas.style.width=800*a+"px";this.scale=a};var Sprite=function(a,b,c,d){this.game=this;this.image=b;this.w=c;this.h=d;this.animations={};this.animation=null};Sprite.prototype.addAnimation=function(a){this.animations[a.name]=a};
Sprite.prototype.setAnimation=function(a){a=this.animations[a];for(var b in this.animations)this.animations[b]!=a&&(this.animations[b].isCurrentAnimation=!1);this.animation!=a&&(this.animation=a,a.frameCount=0)};var Animation=function(a,b,c,d){this.game=a;this.name=b;this.frames=c;this.speed=d||null;this.frameCount=0;this.time=d};Animation.prototype.update=function(a){this.speed&&(0>=this.time?(this.addFrame(),this.time=this.speed):this.time-=1E3*a)};
Animation.prototype.addFrame=function(){this.frameCount<this.frames.length-1?this.frameCount++:this.frameCount=0};Animation.prototype.getCurrentFrame=function(){return this.frames[this.frameCount]};
var Keyboard=function(a){this.game=a;this.keys={W:87,A:65,S:83,D:68,P:80,LEFT:37,UP:38,RIGHT:39,DOWN:40};this.keysDown=[];var b=this;window.addEventListener("keydown",function(a){a.preventDefault();b.keysDown["k"+a.keyCode]=!0});window.addEventListener("keyup",function(a){a.preventDefault();console.log(80==a.keyCode);80==a.keyCode&&b.game.currentState instanceof PlayState&&(b.game.pause=!b.game.pause,b.game.time.lastDate=Date.now());delete b.keysDown["k"+a.keyCode]})};
Keyboard.prototype.isDown=function(a){return"k"+a in this.keysDown};var MenuState=function(a){this.game=a;console.log("chamando o menu");var b=this;setInterval(function(){},1E4);this.buttons={start:{text:"START",fontSize:"20px",rx:b.game.screen.hw-75,ry:270,w:150,h:30,scale:1,hitbox:{offsetX:0,offsetY:0,w:150,h:30}}};a.mouse.onClick(function(a,d){b.game.hasCollision({rx:a,ry:d,scale:1,hitbox:{offsetX:0,offsetY:0,w:2,h:2}},b.buttons.start)&&b.game.startState("play")})};MenuState.prototype.update=function(){};
MenuState.prototype.draw=function(a){a.fillStyle="white";a.fillRect(0,0,1E3,1E3);this.game.renderer.drawText("> protect the core glitch from the evil robots",this.game.screen.hw,170,{fontSize:"18px",textAlign:"center"});this.game.renderer.drawText("> [W, A, S, D] and arrow keys to move",this.game.screen.hw,200,{fontSize:"18px",textAlign:"center"});this.game.renderer.drawText("> mouse to aim and shoot",this.game.screen.hw,230,{fontSize:"18px",textAlign:"center"});this.game.renderer.drawText("Glitch Guy",
this.game.screen.w/2+2-4*Math.random(),102-4*Math.random(),{fontSize:"60px",textAlign:"center"});for(var b in this.buttons)a=this.buttons[b],this.game.renderer.drawButton(a.text,a.fontSize,a.rx,a.ry,a.w,a.h)};
var PlayState=function(a){this.game=a;var b=this;this.setupEntities();this.selectedHero=null;a.mouse.onClick(function(c,d){if(!a.pause){var e=Math.atan2(d-b.hero.y,c-b.hero.x),l=Math.cos(e),f=Math.sin(e),e=new Bullet(b.game,b.hero,e);e.velocity(l*e.speed,f*e.speed);b.game.add(e,"bullets");b.game.audioManager.play("fire")}});this.timeToWave=500;this.score=0};PlayState.prototype.update=function(a){this.score+=1*a;0>=this.timeToWave?(this.timeToWave=1300,this.wave()):this.timeToWave-=1E3*this.game.time.deltaTime};
PlayState.prototype.draw=function(a){a.fillStyle="#c3bfc5";a.fillRect(0,0,1E3,1E3);this.game.renderer.drawText("score: "+Math.floor(this.score),20,20,{fontSize:"18px"})};
PlayState.prototype.wave=function(){var a=Math.floor(4*Math.random()),b=y=speed=s=0;s=Math.ceil(2*Math.random());0==a?(y=Math.floor(Math.random()*this.game.screen.h),speed=100):1==a?(b=Math.floor(Math.random()*this.game.screen.w),speed=50,s+=2):2==a?(b=this.game.screen.w,y=Math.floor(Math.random()*this.game.screen.h),speed=100):(b=Math.floor(Math.random()*this.game.screen.w),y=this.game.screen.h,speed=50,s+=2);a=new Enemy(this.game,b,y);a.scale=s;a.speed=speed;a.destiny(this.game.renderer.canvas.width/
2,this.game.renderer.canvas.height/2);this.game.add(a,"enemies")};PlayState.prototype.setupEntities=function(a){this.enimies=this.game.createGroup("enemies");this.bullets=this.game.createGroup("bullets");this.particles=this.game.createGroup("particles");this.hero=new Hero(this.game,this.game.screen.hw-30,this.game.screen.hh);this.hero.gun=new Gun(this.game,this.hero);this.core=new Core(this.game);this.game.add(this.hero);this.game.add(this.hero.gun);this.game.add(this.core)};
var GameOverState=function(a,b){this.game=a;this.data=b;console.log("chamando o menu");var c=this;setInterval(function(){},1E4);this.buttons={start:{text:"PLAY AGAIN",fontSize:"20px",rx:c.game.screen.hw-75,ry:300,w:150,h:30,scale:1,hitbox:{offsetX:0,offsetY:0,w:150,h:30}},menu:{text:"MENU",fontSize:"20px",rx:c.game.screen.hw-75,ry:350,w:150,h:30,scale:1,hitbox:{offsetX:0,offsetY:0,w:150,h:30}}};a.mouse.onClick(function(a,b){c.game.hasCollision({rx:a,ry:b,scale:1,hitbox:{offsetX:0,offsetY:0,w:2,h:2}},
c.buttons.start)?c.game.startState("play"):c.game.hasCollision({rx:a,ry:b,scale:1,hitbox:{offsetX:0,offsetY:0,w:2,h:2}},c.buttons.menu)&&c.game.startState("menu")})};GameOverState.prototype.update=function(){};
GameOverState.prototype.draw=function(a){a.fillStyle="white";a.fillRect(0,0,1E3,1E3);this.game.renderer.drawText("Game Over",this.game.screen.hw+2-4*Math.random(),102-4*Math.random(),{fontSize:"60px",textAlign:"center"});this.game.renderer.drawText("score: "+this.data,this.game.screen.hw,200,{fontSize:"28px",textAlign:"center"});for(var b in this.buttons)a=this.buttons[b],this.game.renderer.drawButton(a.text,a.fontSize,a.rx,a.ry,a.w,a.h)};
var Game=function(){this.entities=[];this.collisions=[];this.currentState=null;this.renderer=new Renderer(this);this.audioManager=null;this.time=new Time(this);this.mouse=new Mouse(this);this.screen=new Screen(this,800,480);this.assetManager=new AssetManager(this);this.audioManager=new AudioManager;this.keyboard=new Keyboard(this);this.pause=!1;this.states={menu:MenuState,play:PlayState,gameover:GameOverState};this.assetManager.load([{name:"hero1",path:"hero1.png"},{name:"bullet",path:"bullet.png"},
{name:"gun",path:"gun.png"},{name:"robot",path:"robot.png"}]);this.audioManager.load({fire:[2,,.1878,,.1546,.5929,.2,-.2381,,,,,,.7067,-.5589,,,,1,,,,,.5],explosion1:[3,,.1242,.3111,.4624,.2182,,,,,,.2681,.7455,,,.5677,,,1,,,,,.5],explosion2:[3,,.3083,.5953,.4399,.1956,,.0331,,,,-.1818,.7617,,,,,,1,,,,,.5],hit:[3,,.0241,,.2978,.3721,,-.5332,,,,,,,,,,,1,,,.1179,,.5]});var a=this;this.assetManager.onFinishLoad(function(){a.startState("menu");a.loop()});this.colors="#40FEFD #FCFF2C #02F401 #FB27FA #2A00E2 #ff0000".split(" ")};
Game.prototype.update=function(){this.time.update();this.currentState.update(this.time.deltaTime)};Game.prototype.draw=function(){this.renderer.clear();this.renderer.draw();this.currentState.draw(this.renderer.ctx)};
Game.prototype.loop=function(){requestAnimFrame(this.loop.bind(this));if(!this.pause&&this.assetManager.finishedLoad){this.update();this.draw();var a;if(this.currentState)for(var b in this.entities){if(!this.entities[b])break;if(this.entities[b]instanceof Array)for(var c in this.entities[b]){if(!this.entities[b])break;a=this.entities[b][c];a.update(this.time.deltaTime);a.draw(this.renderer.ctx)}else a=this.entities[b],a.update(this.time.deltaTime),a.draw(this.renderer.ctx)}}};
Game.prototype.startState=function(a,b){this.mouse.clickCallbacks=[];this.entities=[];this.currentState=new this.states[a](this,b);console.log("starting state "+a,this.currentState)};Game.prototype.hasCollision=function(a,b){if(a.hitbox||!b.hitbox)return ax=a.rx+a.hitbox.offsetX*a.scale,ay=a.ry+a.hitbox.offsetY*a.scale,bx=b.rx+b.hitbox.offsetX*b.scale,by=b.ry+b.hitbox.offsetY*b.scale,ax<bx+b.hitbox.w*b.scale&&ax+a.hitbox.w*a.scale>bx&&ay<by+b.hitbox.h*b.scale&&a.hitbox.h*a.scale+ay>by};
Game.prototype.add=function(a,b){null==b?this.entities.push(a):(this.entities[b].push(a),a.group=b)};Game.prototype.remove=function(a){var b;a.group=null;b=this.entities[a.group].indexOf(a);-1!=b&&this.entities[a.group].splice(b,1)};Game.prototype.createGroup=function(a){return this.entities[a]=[]};
Game.prototype.collide=function(a,b,c,d){if(a.isAlive)if(null!=b.entities){for(var e in b.entities){var l=!1,f=b.entities[e];ax=a.x-a.w*a.px;ay=a.y-a.h*a.py;bx=f.x-f.w*f.px;by=f.y-f.h*f.py;ax<bx+f.w&&ax+a.w>bx&&ay<by+f.h&&a.h+ay>by&&(a instanceof Bullet?a.kill():c(f),console.log("collide",e,f.isAlive,a.isAlive),l=!0)}!l&&d&&d()}else b.isAlive&&(f=b,ax=a.x-a.w*a.pivot,ay=a.y-a.h*a.pivot,bx=f.x-f.w*f.pivot,by=f.y-f.h*f.pivot,ax<bx+f.w&&ax+a.w>bx&&ay<by+f.h&&a.h+ay>by&&c(f))};var g=new Game;